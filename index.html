<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>标哥图标助手</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary-color: #000000;
            --primary-light: #333333;
            --primary-dark: #000000;
            --accent-color: #0066cc;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --divider-color: #d2d2d7;
            --surface-color: #ffffff;
            --background-color: #fbfbfd;
            --success-color: #00b300;
            --error-color: #ff3b30;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes subtle-float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0); }
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes scale-in {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes blur-in {
            from { backdrop-filter: blur(0); opacity: 0; }
            to { backdrop-filter: blur(20px); opacity: 1; }
        }

        body {
            font-family: "SF Pro Display", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #fbfbfd 0%, #f5f5f7 100%);
            color: var(--text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        .theme-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 24px;
            position: relative;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header-section {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            z-index: 100;
            padding: 24px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            position: relative;
            height: 80px;
            display: flex;
            align-items: center;
        }

        .title-group {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 2;
        }

        .icon-mosaic {
            position: absolute;
            top: -20px;
            left: -20px;
            right: -20px;
            bottom: -20px;
            overflow: hidden;
            opacity: 0.06;
            pointer-events: none;
            z-index: 1;
        }

        .mosaic-icon {
            position: absolute;
            transform-origin: center;
            border-radius: 6px;
        }

        .floating-icons {
            position: absolute;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            display: flex;
            gap: 16px;
            z-index: 1;
        }

        .floating-icon {
            width: 24px;
            height: 24px;
            opacity: 0.2;
            animation: float-icon 3s ease-in-out infinite;
        }

        .floating-icon:nth-child(2n) {
            animation-delay: 0.5s;
        }

        .floating-icon:nth-child(3n) {
            animation-delay: 1s;
        }

        @keyframes float-icon {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-10px) rotate(5deg);
            }
        }

        .brand-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-color), #0077ed);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-right: 16px;
            position: relative;
            overflow: hidden;
        }

        .brand-icon::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 0%,
                rgba(255,255,255,0.1) 50%,
                transparent 100%
            );
            animation: shine 3s linear infinite;
        }

        @keyframes shine {
            0% {
                transform: rotate(0) translate(-50%, -50%);
            }
            100% {
                transform: rotate(360deg) translate(-50%, -50%);
            }
        }

        .page-title {
            font-size: 28px;
            line-height: 1.1;
            font-weight: 600;
            letter-spacing: -0.015em;
            color: var(--primary-color);
            margin: 0;
        }

        .page-subtitle {
            font-size: 16px;
            line-height: 1.2;
            font-weight: 400;
            color: var(--text-secondary);
            margin: 0;
        }

        .main-content {
            margin-top: 80px;
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        .gradient-blob {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            height: 800px;
            background: radial-gradient(
                circle at center,
                rgba(0, 102, 204, 0.05) 0%,
                rgba(255, 255, 255, 0.1) 30%,
                rgba(0, 102, 204, 0.05) 60%,
                rgba(255, 255, 255, 0.1) 100%
            );
            filter: blur(80px);
            opacity: 0.8;
            animation: blob-rotate 20s linear infinite;
            z-index: -1;
            pointer-events: none;
        }

        .gradient-blob::before {
            content: '';
            position: absolute;
            inset: -100px;
            background: radial-gradient(
                circle at center,
                rgba(255, 255, 255, 0.1) 0%,
                rgba(0, 102, 204, 0.05) 40%,
                rgba(255, 255, 255, 0.1) 100%
            );
            animation: blob-rotate-reverse 15s linear infinite;
        }

        @keyframes blob-rotate {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        @keyframes blob-rotate-reverse {
            0% {
                transform: rotate(360deg);
            }
            100% {
                transform: rotate(0deg);
            }
        }

        .search-section {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.06);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
        }

        .search-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 100%);
            pointer-events: none;
        }

        .theme-input {
            font-size: 18px;
            height: 48px;
            padding: 0 16px;
            border: 1px solid var(--divider-color);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin: 32px 0;
        }

        .option-group {
            position: relative;
        }

        .option-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            letter-spacing: 0.02em;
            text-transform: uppercase;
        }

        .option-select-wrapper {
            position: relative;
            width: 100%;
        }

        .theme-select {
            appearance: none;
            -webkit-appearance: none;
            width: 100%;
            height: 44px;
            padding: 0 36px 0 16px;
            font-size: 15px;
            color: var(--text-primary);
            background: var(--surface-color);
            border: 1px solid var(--divider-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .theme-select:hover {
            background: #f5f5f7;
            border-color: #b6b6b6;
        }

        .theme-select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.15);
        }

        .option-select-wrapper::after {
            content: '';
            position: absolute;
            right: 14px;
            top: 50%;
            width: 8px;
            height: 8px;
            border-right: 2px solid var(--text-secondary);
            border-bottom: 2px solid var(--text-secondary);
            transform: translateY(-70%) rotate(45deg);
            pointer-events: none;
            transition: all 0.2s ease;
        }

        .option-select-wrapper:hover::after {
            border-color: var(--text-primary);
        }

        .theme-select option {
            font-size: 15px;
            padding: 12px;
            background: var(--surface-color);
            color: var(--text-primary);
        }

        .theme-button {
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 17px;
            font-weight: 500;
            color: white;
            background: var(--accent-color);
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 32px;
        }

        .theme-button:hover {
            background: #0077ed;
            transform: translateY(-1px);
        }

        .theme-button:active {
            background: #0055cc;
            transform: translateY(0);
        }

        .theme-button .material-icons {
            font-size: 20px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
            margin-top: 40px;
            padding: 0 20px;
        }

        .icon-container {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) backwards;
        }

        .icon-container:hover {
            transform: scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.08);
        }

        .icon-container h3 {
            font-size: 20px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 24px;
            letter-spacing: -0.022em;
        }

        .icon-preview-wrapper {
            background: linear-gradient(135deg, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.4) 100%);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .icon-preview-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%);
            transform: translateX(-100%);
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .icon-preview-wrapper:hover::before {
            transform: translateX(100%);
        }

        .icon-preview {
            width: 80px;
            height: 80px;
            object-fit: contain;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
            transition: all 0.3s ease;
        }

        .icon-preview:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.15));
        }

        .icon-size-badge {
            position: absolute;
            bottom: 12px;
            right: 12px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            backdrop-filter: blur(4px);
        }

        .icon-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .icon-button {
            flex: 1;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            letter-spacing: -0.01em;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .download-button {
            background: var(--accent-color);
            color: white;
        }

        .preview-button {
            background: rgba(0,0,0,0.05);
            color: var(--text-primary);
        }

        .icon-button:hover {
            transform: translateY(-2px);
        }

        .download-button:hover {
            background: var(--accent-color);
            box-shadow: 0 8px 20px rgba(0,102,204,0.2);
        }

        .preview-button:hover {
            background: rgba(0,0,0,0.08);
        }

        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .no-results svg {
            width: 64px;
            height: 64px;
            margin: 0 auto 24px;
            color: var(--text-secondary);
        }

        .no-results h3 {
            font-size: 24px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 12px;
            letter-spacing: -0.022em;
        }

        .no-results p {
            font-size: 16px;
            color: var(--text-secondary);
            max-width: 400px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .title-group {
                flex-direction: column;
                gap: 4px;
            }

            .main-content {
                margin-top: 120px;
            }

            .search-section {
                padding: 20px;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }
        }

        .features-section {
            margin-top: 80px;
            padding: 60px 0;
            background: linear-gradient(180deg, var(--background-color) 0%, #ffffff 100%);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            margin-top: 40px;
        }

        .feature-card {
            padding: 40px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.06);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 24px;
            color: var(--accent-color);
        }

        .feature-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            letter-spacing: -0.022em;
        }

        .feature-description {
            font-size: 17px;
            line-height: 1.5;
            color: var(--text-secondary);
        }

        .section-title {
            font-size: 40px;
            font-weight: 600;
            text-align: center;
            color: var(--text-primary);
            margin-bottom: 16px;
            letter-spacing: -0.022em;
        }

        .section-subtitle {
            font-size: 20px;
            text-align: center;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }
    </style>
</head>

<body>
    <header class="header-section">
        <div class="header-content">
            <div class="icon-mosaic" id="iconMosaic">
                <!-- 图标将通过JavaScript动态生成 -->
        </div>
            <div class="title-group">
                <div class="brand-icon">
                    <span class="material-icons">widgets</span>
                </div>
                    <div>
                    <h1 class="page-title">标哥</h1>
                    <p class="page-subtitle">找图标，杠杠的</p>
                </div>
            </div>
        </div>
    </header>

    <div class="theme-container">
        <main class="main-content">
            <section class="search-section">
                <div class="gradient-blob"></div>
                <form id="searchForm">
                    <div class="relative">
                        <input type="text" id="url" class="theme-input w-full" 
                            placeholder="输入网站名称或网址，例如：淘宝、bilibili、google.com">
                    </div>
                    <div class="options-grid">
                        <div class="option-group">
                            <label class="option-label">图标尺寸</label>
                            <div class="option-select-wrapper">
                                <select id="size" class="theme-select">
                                    <option value="16">16 × 16 像素</option>
                                    <option value="32">32 × 32 像素</option>
                                    <option value="48">48 × 48 像素</option>
                                    <option value="64" selected>64 × 64 像素</option>
                                    <option value="128">128 × 128 像素</option>
                                    <option value="256">256 × 256 像素</option>
                        </select>
                    </div>
                        </div>
                        <div class="option-group">
                            <label class="option-label">图标格式</label>
                            <div class="option-select-wrapper">
                                <select id="format" class="theme-select">
                                    <option value="png" selected>PNG — 最佳质量，支持透明</option>
                                    <option value="webp">WebP — 高压缩，现代浏览器</option>
                                    <option value="jpeg">JPEG — 兼容性最好</option>
                        </select>
                    </div>
                </div>
                    </div>
                    <button type="submit" class="theme-button w-full">
                        <span class="material-icons">search</span>
                        开始搜索
                </button>
            </form>
            </section>

            <div id="results" class="results-grid">
            <!-- 结果将在这里显示 -->
        </div>
        </main>

        <section class="features-section">
            <div class="container mx-auto px-6">
                <h2 class="section-title">强大的图标处理能力</h2>
                <p class="section-subtitle">支持多种格式转换，快速处理，安全可靠</p>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
                        </svg>
                        <h3 class="feature-title">全面的格式支持</h3>
                        <p class="feature-description">支持超过 300 种不同的图标格式，提供多种转换方式，全面超越其他工具。无论是常见还是专业格式，我们都能满足您的需求。</p>
                    </div>

                    <div class="feature-card">
                        <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        <h3 class="feature-title">快速简便</h3>
                        <p class="feature-description">简单直观的操作界面，输入网址即可快速获取图标。我们的目标是在几秒钟内完成所有处理过程，让您的工作更加高效。</p>
                    </div>

                    <div class="feature-card">
                        <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                        </svg>
                        <h3 class="feature-title">云端处理</h3>
                        <p class="feature-description">所有处理都在云端进行，不消耗您的计算机资源。多个服务器节点保证处理速度，让您随时随地都能使用。</p>
                    </div>

                    <div class="feature-card">
                        <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                        </svg>
                        <h3 class="feature-title">自定义设置</h3>
                        <p class="feature-description">提供多种自定义选项，包括尺寸调整、格式转换、质量设置等。您可以根据需求精确控制输出效果。</p>
                    </div>

                    <div class="feature-card">
                        <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                        <h3 class="feature-title">安全保障</h3>
                        <p class="feature-description">采用安全的处理流程，所有数据传输均经过加密。我们不会保存您的任何文件，确保您的隐私安全。</p>
                    </div>

                    <div class="feature-card">
                        <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                        <h3 class="feature-title">全平台支持</h3>
                        <p class="feature-description">基于浏览器的解决方案，支持所有主流平台和设备。无需下载安装任何软件，随时随地都能使用。</p>
                    </div>
                    </div>
                </div>
        </section>
    </div>

    <canvas id="conversionCanvas" style="display: none;"></canvas>

    <script>
        // 在现有脚本的开头添加以下代码
        const iconUrls = [
            'https://logo.clearbit.com/apple.com',
            'https://logo.clearbit.com/google.com',
            'https://logo.clearbit.com/microsoft.com',
            'https://logo.clearbit.com/amazon.com',
            'https://logo.clearbit.com/facebook.com',
            'https://logo.clearbit.com/netflix.com',
            'https://logo.clearbit.com/spotify.com',
            'https://logo.clearbit.com/twitter.com',
            'https://logo.clearbit.com/linkedin.com',
            'https://logo.clearbit.com/github.com',
            'https://logo.clearbit.com/adobe.com',
            'https://logo.clearbit.com/airbnb.com',
            'https://logo.clearbit.com/alibaba.com',
            'https://logo.clearbit.com/android.com',
            'https://logo.clearbit.com/baidu.com',
            'https://logo.clearbit.com/bing.com',
            'https://logo.clearbit.com/dropbox.com',
            'https://logo.clearbit.com/ebay.com',
            'https://logo.clearbit.com/firefox.com',
            'https://logo.clearbit.com/github.com',
            'https://logo.clearbit.com/instagram.com',
            'https://logo.clearbit.com/intel.com',
            'https://logo.clearbit.com/medium.com',
            'https://logo.clearbit.com/nintendo.com',
            'https://logo.clearbit.com/nvidia.com',
            'https://logo.clearbit.com/paypal.com',
            'https://logo.clearbit.com/pinterest.com',
            'https://logo.clearbit.com/reddit.com',
            'https://logo.clearbit.com/samsung.com',
            'https://logo.clearbit.com/slack.com',
            'https://logo.clearbit.com/snapchat.com',
            'https://logo.clearbit.com/sony.com',
            'https://logo.clearbit.com/steam.com',
            'https://logo.clearbit.com/telegram.org',
            'https://logo.clearbit.com/tencent.com',
            'https://logo.clearbit.com/tesla.com',
            'https://logo.clearbit.com/tiktok.com',
            'https://logo.clearbit.com/twitch.tv',
            'https://logo.clearbit.com/uber.com',
            'https://logo.clearbit.com/unity.com',
            'https://logo.clearbit.com/vimeo.com',
            'https://logo.clearbit.com/visa.com',
            'https://logo.clearbit.com/walmart.com',
            'https://logo.clearbit.com/whatsapp.com',
            'https://logo.clearbit.com/xiaomi.com',
            'https://logo.clearbit.com/yahoo.com',
            'https://logo.clearbit.com/youtube.com',
            'https://logo.clearbit.com/zoom.us'
        ];

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createMosaicBackground() {
            const container = document.getElementById('iconMosaic');
            const containerRect = container.getBoundingClientRect();
            
            // 清空现有内容
            container.innerHTML = '';
            
            // 计算网格布局参数
            const gridGap = 20;
            const minIconSize = 16;
            const maxIconSize = 40;
            const columns = Math.ceil(containerRect.width / (maxIconSize + gridGap));
            const rows = Math.ceil(containerRect.height / (maxIconSize + gridGap));
            const totalCells = columns * rows;
            
            // 创建不重复的图标数组
            let availableIcons = [...iconUrls];
            let usedIcons = new Set();
            let currentIcons = [];
            
            // 确保每个相邻位置的图标都不相同
            for (let i = 0; i < totalCells; i++) {
                // 如果可用图标用完了，重新填充（但排除已经在邻近位置使用的图标）
                if (availableIcons.length === 0) {
                    availableIcons = iconUrls.filter(icon => !usedIcons.has(icon));
                    usedIcons.clear();
                }
                
                // 获取当前位置的邻近位置
                const row = Math.floor(i / columns);
                const col = i % columns;
                const neighbors = new Set();
                
                // 检查上、左、右位置的图标
                if (row > 0 && currentIcons[(row - 1) * columns + col]) {
                    neighbors.add(currentIcons[(row - 1) * columns + col]);
                }
                if (col > 0 && currentIcons[row * columns + (col - 1)]) {
                    neighbors.add(currentIcons[row * columns + (col - 1)]);
                }
                if (col < columns - 1 && currentIcons[row * columns + (col + 1)]) {
                    neighbors.add(currentIcons[row * columns + (col - 1)]);
                }
                
                // 从可用图标中筛选出不在邻近位置的图标
                const validIcons = availableIcons.filter(icon => !neighbors.has(icon));
                
                // 如果没有合适的图标，使用任何未在邻近使用的图标
                const selectedIcon = validIcons.length > 0 
                    ? validIcons[Math.floor(Math.random() * validIcons.length)]
                    : availableIcons[Math.floor(Math.random() * availableIcons.length)];
                
                // 记录使用的图标
                currentIcons.push(selectedIcon);
                usedIcons.add(selectedIcon);
                availableIcons = availableIcons.filter(icon => icon !== selectedIcon);
                
                // 创建图标元素
                const img = document.createElement('img');
                img.className = 'mosaic-icon';
                img.src = selectedIcon;
                img.alt = 'icon';
                
                // 计算位置和大小
                const size = minIconSize + Math.random() * (maxIconSize - minIconSize);
                const offsetX = Math.random() * gridGap - gridGap / 2;
                const offsetY = Math.random() * gridGap - gridGap / 2;
                
                const left = (col * (maxIconSize + gridGap)) + offsetX;
                const top = (row * (maxIconSize + gridGap)) + offsetY;
                
                img.style.width = `${size}px`;
                img.style.height = `${size}px`;
                img.style.left = `${left}px`;
                img.style.top = `${top}px`;
                
                // 添加随机旋转和动画效果
                const rotation = Math.random() * 60 - 30;
                img.style.transform = `rotate(${rotation}deg)`;
                img.style.opacity = 0.4 + Math.random() * 0.6;
                img.style.animation = `fadeIn 0.5s ease-out ${Math.random() * 0.5}s backwards`;
                
                container.appendChild(img);
            }
        }

        // 页面加载时创建背景
        window.addEventListener('load', createMosaicBackground);

        // 窗口大小改变时重新创建
        window.addEventListener('resize', createMosaicBackground);

        // 图标转换函数
        async function convertIcon(imgUrl, format, size) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                const canvas = document.getElementById('conversionCanvas');
                const ctx = canvas.getContext('2d', {
                    alpha: true,
                    imageSmoothingEnabled: true,
                    imageSmoothingQuality: 'high'
                });

                img.crossOrigin = 'anonymous';
                img.onload = () => {
                    // 使用2倍大小进行渲染，然后缩小，提高清晰度
                    const scale = 2;
                    canvas.width = size * scale;
                    canvas.height = size * scale;

                    // 清空画布并设置背景
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // 如果是JPEG格式，添加白色背景
                    if (format.toLowerCase() === 'jpeg') {
                        ctx.fillStyle = '#FFFFFF';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                    }
                    
                    // 计算绘制尺寸，保持宽高比
                    const drawScale = Math.min(canvas.width / img.width, canvas.height / img.height);
                    const drawWidth = img.width * drawScale;
                    const drawHeight = img.height * drawScale;
                    const x = (canvas.width - drawWidth) / 2;
                    const y = (canvas.height - drawHeight) / 2;

                    // 使用高质量插值
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';

                    // 绘制图像
                    ctx.drawImage(img, x, y, drawWidth, drawHeight);

                    // 创建临时画布进行缩放
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = size;
                    tempCanvas.height = size;
                    const tempCtx = tempCanvas.getContext('2d', {
                        alpha: true,
                        imageSmoothingEnabled: true,
                        imageSmoothingQuality: 'high'
                    });

                    // 将大尺寸图像缩小到目标尺寸
                    tempCtx.drawImage(canvas, 0, 0, canvas.width, canvas.height, 0, 0, size, size);

                    try {
                        let mimeType;
                        let quality = 1.0;
                        switch (format.toLowerCase()) {
                            case 'webp':
                                if (!tempCanvas.toDataURL('image/webp').startsWith('data:image/webp')) {
                                    // 如果浏览器不支持WebP，回退到PNG
                                mimeType = 'image/png';
                                    format = 'png';
                                } else {
                                    mimeType = 'image/webp';
                                    quality = 0.9;
                                }
                                break;
                            case 'jpeg':
                                mimeType = 'image/jpeg';
                                quality = 0.95;
                                break;
                            default:
                                mimeType = 'image/png';
                                format = 'png';
                        }
                        const dataUrl = tempCanvas.toDataURL(mimeType, quality);
                        resolve({dataUrl, format}); // 返回转换后的格式信息
                    } catch (error) {
                        // 如果转换失败，回退到PNG
                        const dataUrl = tempCanvas.toDataURL('image/png');
                        resolve({dataUrl, format: 'png'});
                    }
                };

                img.onerror = () => {
                    reject(new Error('Failed to load image'));
                };

                img.src = imgUrl;
            });
        }

        // 更新翻译函数，使用免费的在线服务
        async function translateToEnglish(chinese) {
            const translationServices = [
                // DeepL免费翻译
                {
                    url: 'https://api-free.deepl.com/v2/translate',
                    handler: async (text) => {
                        try {
                            const response = await fetch(`https://lingva.ml/api/v1/zh/en/${encodeURIComponent(text)}`);
                            const data = await response.json();
                            return data.translation?.toLowerCase();
                        } catch (error) {
                            console.error('DeepL translation error:', error);
                            return null;
                        }
                    }
                },
                // LibreTranslate
                {
                    url: 'https://libretranslate.de/translate',
                    handler: async (text) => {
                        try {
                            const response = await fetch(url, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    q: text,
                                    source: 'zh',
                                    target: 'en'
                                })
                            });
                            const data = await response.json();
                            return data.translatedText?.toLowerCase();
                        } catch (error) {
                            console.error('LibreTranslate error:', error);
                            return null;
                        }
                    }
                },
                // Lingva Translate
                {
                    url: 'https://lingva.ml',
                    handler: async (text) => {
                        try {
                            const response = await fetch(`https://lingva.ml/api/v1/zh/en/${encodeURIComponent(text)}`);
                            const data = await response.json();
                            return data.translation?.toLowerCase();
                        } catch (error) {
                            console.error('Lingva translation error:', error);
                            return null;
                        }
                    }
                }
            ];

            // 添加本地缓存
            const cacheKey = `translation_${chinese}`;
            const cached = localStorage.getItem(cacheKey);
            if (cached) {
                return cached;
            }

            // 尝试所有翻译服务
            for (const service of translationServices) {
                try {
                    const result = await service.handler(chinese);
                    if (result) {
                        // 清理翻译结果
                        const cleanResult = result.replace(/\s+/g, '')
                            .replace(/[^a-z0-9]/g, '')
                            .toLowerCase();
                        
                        // 缓存结果
                        localStorage.setItem(cacheKey, cleanResult);
                        return cleanResult;
                    }
                } catch (error) {
                    console.error('Translation service error:', error);
                    continue;
                }
            }

            // 如果所有服务都失败，尝试使用拼音
            return getPinyin(chinese);
        }

        // 更新拼音转换函数，使用免费的在线服务
        async function getPinyin(chinese) {
            const pinyinServices = [
                // PinYin API
                {
                    url: 'https://gist.githubusercontent.com/lxneng/1031058/raw/98ab0f2fedf574ae40b69650eb797ed879aed5f8/pinyin.py',
                    handler: async (text) => {
                        try {
                            const response = await fetch(`https://api.pinyin.dev/v1/pinyin?text=${encodeURIComponent(text)}`);
                            const data = await response.json();
                            return data.pinyin?.join('')?.toLowerCase();
                        } catch (error) {
                            console.error('Pinyin API error:', error);
                            return null;
                        }
                    }
                },
                // Chinese to Pinyin converter
                {
                    url: 'https://www.chineseconverter.com/api/convert/chinese-to-pinyin',
                    handler: async (text) => {
                        try {
                            const response = await fetch(`https://www.chineseconverter.com/api/convert/chinese-to-pinyin?text=${encodeURIComponent(text)}`);
                            const data = await response.json();
                            return data.pinyin?.toLowerCase().replace(/\s+/g, '');
                        } catch (error) {
                            console.error('Chinese converter error:', error);
                            return null;
                        }
                    }
                }
            ];

            // 添加本地缓存
            const cacheKey = `pinyin_${chinese}`;
            const cached = localStorage.getItem(cacheKey);
            if (cached) {
                return cached;
            }

            // 尝试所有拼音服务
            for (const service of pinyinServices) {
                try {
                    const result = await service.handler(chinese);
                    if (result) {
                        // 缓存结果
                        localStorage.setItem(cacheKey, result);
                        return result;
                    }
                } catch (error) {
                    console.error('Pinyin service error:', error);
                    continue;
                }
            }

            // 如果所有服务都失败，返回null
            return null;
        }

        // 更新常用词匹配系统，添加更多国内网站
        const commonTerms = {
            // 新闻资讯
            '今日头条': 'toutiao.com',
            '头条': 'toutiao.com',
            '网易': '163.com',
            '新浪': 'sina.com.cn',
            '搜狐': 'sohu.com',
            '凤凰网': 'ifeng.com',
            '腾讯网': 'qq.com',
            '澎湃': 'thepaper.cn',
            
            // 社交媒体
            '微信': 'weixin.qq.com',
            '微博': 'weibo.com',
            '知乎': 'zhihu.com',
            '豆瓣': 'douban.com',
            '抖音': 'douyin.com',
            '快手': 'kuaishou.com',
            '小红书': 'xiaohongshu.com',
            
            // 视频网站
            '哔哩哔哩': 'bilibili.com',
            'b站': 'bilibili.com',
            '优酷': 'youku.com',
            '爱奇艺': 'iqiyi.com',
            '腾讯视频': 'v.qq.com',
            '芒果tv': 'mgtv.com',
            
            // 购物平台
            '淘宝': 'taobao.com',
            '天猫': 'tmall.com',
            '京东': 'jd.com',
            '拼多多': 'pinduoduo.com',
            '苏宁': 'suning.com',
            '唯品会': 'vip.com',
            '当当': 'dangdang.com',
            
            // 生活服务
            '美团': 'meituan.com',
            '饿了么': 'ele.me',
            '大众点评': 'dianping.com',
            '携程': 'ctrip.com',
            '飞猪': 'fliggy.com',
            '滴滴': 'didichuxing.com',
            
            // 教育学习
            '百度': 'baidu.com',
            '百度翻译': 'fanyi.baidu.com',
            '有道': 'youdao.com',
            '网易云课堂': 'study.163.com',
            '慕课网': 'imooc.com',
            
            // 国际网站
            '奈飞': 'netflix.com',
            '网飞': 'netflix.com',
            '油管': 'youtube.com',
            '推特': 'twitter.com',
            '脸书': 'facebook.com',
            '领英': 'linkedin.com',
            '电报': 'telegram.org',
            'ins': 'instagram.com',
            
            // 常用缩写
            '谷歌': 'google.com',
            '微软': 'microsoft.com',
            '亚马逊': 'amazon.com',
            '苹果': 'apple.com',
            
            // 常见组合词
            '谷歌地图': 'maps.google.com',
            '谷歌翻译': 'translate.google.com',
            '谷歌搜索': 'google.com',
            '微软云': 'azure.com',
            '亚马逊云': 'aws.amazon.com',
            
            // 常见后缀匹配
            '官网': '.com',
            '商城': '.com',
            '网站': '.com',
            '主页': '.com'
        };

        // 添加模糊匹配函数
        function fuzzyMatch(input) {
            // 移除常见后缀
            const cleanInput = input.replace(/(官网|商城|网站|主页)$/, '');
            
            // 精确匹配
            if (commonTerms[cleanInput]) {
                return commonTerms[cleanInput];
            }
            
            // 模糊匹配
            for (const [key, value] of Object.entries(commonTerms)) {
                if (cleanInput.includes(key)) {
                    return value;
                }
            }
            
            return null;
        }

        // 更新域名处理函数
        async function processDomain(input) {
            // 移除协议前缀和空格
            let domain = input.replace(/^https?:\/\//, '').trim();
            
            try {
                // 如果输入的已经是完整域名，直接返回
                if (domain.includes('.')) {
                    return domain.split('/')[0];
                }
                
                // 检查是否是IP地址
                if (/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(domain)) {
                    return domain;
                }
                
                // 检查常用词匹配
                const fuzzyResult = fuzzyMatch(domain);
                if (fuzzyResult) {
                    return fuzzyResult;
                }
                
                // 如果包含中文，尝试转换
                if (/[\u4e00-\u9fa5]/.test(domain)) {
                    // 首先尝试翻译
                    const englishName = await translateToEnglish(domain);
                    if (englishName) {
                        return englishName + '.com';
                    }
                    
                    // 如果翻译失败，尝试转拼音
                    const pinyin = await getPinyin(domain);
                    if (pinyin) {
                        return pinyin + '.com';
                    }
                    
                    // 如果都失败了，返回默认搜索引擎
                    return 'baidu.com';
                }
                
                // 非中文输入，添加.com后缀
                return domain.toLowerCase() + '.com';
            } catch (error) {
                console.error('Error in domain processing:', error);
                // 如果处理失败，使用基本处理
                if (domain.includes('.')) {
                    return domain.split('/')[0];
                }
                return domain.toLowerCase() + '.com';
            }
        }

        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const url = document.getElementById('url').value.trim();
            const format = document.getElementById('format').value;
            const size = document.getElementById('size').value;
            const resultsDiv = document.getElementById('results');

            // 更新加载显示
            resultsDiv.innerHTML = `
                <div class="col-span-full">
                    <div class="loading-container">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">正在搜索图标</div>
                        <div class="loading-steps">
                            <div class="loading-step active">
                                <div class="loading-step-icon">🔍</div>
                                <span>正在解析域名...</span>
                        </div>
                            <div class="loading-step">
                                <div class="loading-step-icon">🌐</div>
                                <span>正在搜索图标来源...</span>
                            </div>
                            <div class="loading-step">
                                <div class="loading-step-icon">⚡</div>
                                <span>正在获取高清图标...</span>
                            </div>
                            <div class="loading-step">
                                <div class="loading-step-icon">✨</div>
                                <span>正在优化图标质量...</span>
                            </div>
                        </div>
                        <div class="loading-progress">
                            <div class="loading-progress-bar"></div>
                        </div>
                    </div>
                </div>
            `;

            try {
                // 添加加载步骤更新函数
                function updateLoadingStep(step) {
                    const steps = document.querySelectorAll('.loading-step');
                    steps.forEach((s, index) => {
                        if (index === step) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                }

                updateLoadingStep(0); // 解析域名
                const processedUrl = await processDomain(url);
                
                updateLoadingStep(1); // 搜索图标
                const services = [
                    {
                        name: 'Clearbit Logo (HD)',
                        url: (domain) => `https://logo.clearbit.com/${domain}?size=512`
                    },
                    {
                        name: 'Favicon Kit',
                        url: (domain) => `https://api.faviconkit.com/${domain}/144`
                    },
                    {
                        name: 'Google Favicon (HD)',
                        url: (domain) => `https://www.google.com/s2/favicons?domain=${domain}&sz=256`
                    },
                    {
                        name: 'Favicon Grabber',
                        url: (domain) => `https://favicongrabber.com/api/grab/${domain}`
                    },
                    {
                        name: 'DuckDuckGo Icon',
                        url: (domain) => `https://icons.duckduckgo.com/ip3/${domain}.ico`
                    },
                    {
                        name: 'Yandex Icon',
                        url: (domain) => `https://favicon.yandex.net/favicon/${domain}`
                    },
                    {
                        name: 'CN Icon Service',
                        url: (domain) => `https://favicon.cccyun.cc/${domain}`
                    },
                    {
                        name: 'QQ Favicon',
                        url: (domain) => `https://api.iowen.cn/favicon/${domain}.png`
                    }
                ];

                // 清空结果区域
                resultsDiv.innerHTML = '';

                // 更新图片加载函数，优化对国内网站的支持
                async function loadImage(url) {
                    const MAX_RETRIES = 2;
                    let retries = 0;

                    while (retries <= MAX_RETRIES) {
                        try {
                            const controller = new AbortController();
                            const timeoutId = setTimeout(() => controller.abort(), 8000);

                            // 使用更多的代理服务
                            const proxyUrls = [
                                url,
                                `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                                `https://corsproxy.io/?${encodeURIComponent(url)}`,
                                `https://cors-anywhere.herokuapp.com/${url}`,
                                `https://cors.luckydesigner.workers.dev/?${encodeURIComponent(url)}`,
                                `https://bird.ioliu.cn/v1/?url=${encodeURIComponent(url)}`
                            ];

                            let lastError;
                            for (const proxyUrl of proxyUrls) {
                                try {
                                    const response = await fetch(proxyUrl, {
                                        signal: controller.signal,
                                        mode: 'cors',
                                        headers: {
                                            'Accept': 'image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*',
                                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                                        }
                                    });

                                    if (!response.ok) continue;

                                    const blob = await response.blob();
                                    if (blob.size < 20) continue;

                                    clearTimeout(timeoutId);
                                    return URL.createObjectURL(blob);
                    } catch (error) {
                                    lastError = error;
                        continue;
                    }
                }

                            throw lastError || new Error('All proxy attempts failed');
                        } catch (error) {
                            retries++;
                            if (retries > MAX_RETRIES) {
                                console.error(`Failed to load image after ${MAX_RETRIES} retries:`, url, error);
                                throw error;
                            }
                            await new Promise(resolve => setTimeout(resolve, 1500 * retries));
                        }
                    }
                }

                // 更新图片验证函数，增加更多容错
                async function validateImage(dataUrl) {
                    return new Promise((resolve, reject) => {
                        const img = new Image();
                        const timeout = setTimeout(() => {
                            reject(new Error('Image load timeout'));
                        }, 5000);

                        img.onload = () => {
                            clearTimeout(timeout);
                            // 更宽松的尺寸验证
                            if (img.width < 4 || img.height < 4) {
                                reject(new Error('Invalid image dimensions'));
                            } else {
                                resolve(true);
                            }
                        };

                        img.onerror = () => {
                            clearTimeout(timeout);
                            reject(new Error('Failed to load image'));
                        };

                        img.src = dataUrl;
                    });
                }

                updateLoadingStep(2); // 获取高清图标
                const loadPromises = services.map(async service => {
                    const iconContainer = document.createElement('div');
                    iconContainer.className = 'icon-container bg-white p-4 rounded-lg shadow-sm hover:shadow-md';

                    // 使用新的加载动画样式
                    iconContainer.innerHTML = `
                        <h3 class="text-lg font-semibold mb-3">${service.name}</h3>
                        <div class="flex flex-col items-center space-y-3">
                            <div class="relative">
                                <div class="icon-preview-wrapper">
                                    <div class="loading-spinner" style="width: 30px; height: 30px; border-width: 3px;"></div>
                                </div>
                            </div>
                        </div>
                    `;

                    resultsDiv.appendChild(iconContainer);

                    try {
                        const serviceUrl = service.url(processedUrl);
                        console.log('Trying to load:', serviceUrl);
                        const imageUrl = await loadImage(serviceUrl);
                        const {dataUrl: convertedDataUrl, format: actualFormat} = await convertIcon(imageUrl, format, parseInt(size));

                        await validateImage(convertedDataUrl);

                        // 更新下载按钮文本以反映实际格式
                        const formatDisplay = actualFormat.toUpperCase();
                        const downloadText = actualFormat !== format ? 
                            `下载${formatDisplay}图标 (格式自动转换)` : 
                            `下载${formatDisplay}图标`;

                        iconContainer.innerHTML = `
                            <h3>${service.name}</h3>
                            <div class="icon-preview-wrapper">
                                <img src="${convertedDataUrl}" 
                                     alt="${service.name} icon" 
                                     class="icon-preview"
                                     onerror="this.onerror=null; this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2264%22 height=%2264%22><rect width=%2264%22 height=%2264%22 fill=%22%23f0f0f0%22/><text x=%2232%22 y=%2232%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22>No icon</text></svg>';">
                                <span class="icon-size-badge">${size}x${size}</span>
                            </div>
                            <div class="icon-actions">
                                <a href="${convertedDataUrl}" 
                                   download="icon_${processedUrl}_${size}x${size}.${actualFormat}"
                                   class="icon-button download-button">
                                   <span class="material-icons" style="font-size: 18px;">download</span>
                                   ${downloadText}
                                </a>
                                <a href="${serviceUrl}" 
                                   target="_blank"
                                   class="icon-button preview-button">
                                   <span class="material-icons" style="font-size: 18px;">open_in_new</span>
                                   原图
                                </a>
                            </div>
                        `;

                        URL.revokeObjectURL(imageUrl);
                    } catch (error) {
                        console.error(`Error loading icon from ${service.name}:`, error);
                        iconContainer.remove();
                    }
                });

                await Promise.allSettled(loadPromises);

                // 如果没有找到任何图标，显示提示信息
                if (resultsDiv.children.length === 0) {
                    resultsDiv.innerHTML = `
                        <div class="no-results">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                            <h3>未找到相关图标</h3>
                            <p>请尝试使用其他关键词或网址重新搜索</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="col-span-full text-center p-8">
                        <div class="text-red-500">
                            <svg class="mx-auto h-12 w-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <p class="mt-4 text-lg">搜索出错</p>
                            <p class="mt-2 text-sm">${error.message}</p>
                        </div>
                    </div>
                `;
            }
        });
    </script>
</body>

</html>
